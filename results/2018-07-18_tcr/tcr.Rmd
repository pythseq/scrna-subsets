---
title: "tcr resampling"
author: "Kent Riemondy RBI"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rjson)
library(tidyverse)
source("../../R/globals.R")
```

# Examine TCR resampling metrics

```{r}
barcodes_10x <- c(
  "AAGTCTGAGAAACCGC-1",
  "CTAGCCTGTCTAGCGC-1"
)
```

```{r}
fns <- dir(file.path(data_dir,
                     "tcr_resampling",
                     "cellranger"),
           recursive = T,
           full.names = T,
           pattern = "all_contig_annotations.csv$")
names(fns) <- c("original", "resampled")
annotations <- map_dfr(fns, read_csv, .id = "library")

annotations <- filter(annotations, barcode %in% barcodes_10x)

plot_dat <- filter(annotations,
                   chain != "Multi",
                   cdr3 == "CASSFSTCSANYGYTF" | 
                     cdr3 == "CAVSDLEPNSSASKIIF",
                   high_confidence == "True") 

len_plt <- ggplot(plot_dat,
                  aes(barcode, length)) +
  geom_point(aes(color = library)) +
  facet_wrap(~chain) +
  scale_x_discrete(labels = c("Cell-1", "Cell-2")) +
  scale_y_continuous(labels = scales::comma) + 
  scale_color_manual(values = color_palette,
                     name = "") +
  labs(y = "Assembled Contig Length",
       x = "") + 
  theme(legend.position = "none")

read_plt <- ggplot(plot_dat,
                   aes(barcode, reads)) +
  geom_point(aes(color = library)) +
  facet_wrap(~chain) +
  scale_x_discrete(labels = c("Cell-1", "Cell-2")) +
  scale_y_continuous(labels = scales::comma) + 
  scale_color_manual(values = color_palette,
                     name = "") +
  labs(y = "# of Reads",
       x = "") + 
  theme(legend.position = "none")

plt <- plot_grid(len_plt, read_plt)
save_plot("contig_length_and_reads.pdf", plt, 
          nrow = 1, ncol = 2)
plt
```
