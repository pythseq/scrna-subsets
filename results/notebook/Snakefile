""" Snakefile to produce figures """
import os
RESULTS = "../"

PLOT_RMD = [
  ["2018-05-16_mouse_human", "plot"],
  ["2018-05-15_pbmc", "mkcell_pulldown"],
  ["2018-04-27_pcr_expt", "pcr_enrichment"],
  ["2018-05-21_new_old_umis", "umis"],
  ["2018-07-10_species_specificity", "species-spec"],
  ["2018-07-19_genes", "cd3d"],
  ["2018-07-24_barcode_off_target", "bc"]
  ]

PROCESSING_RMD = [
  ["2018-05-16_mouse_human"],
  ]

PLOT_RMDS = [os.path.join(*x) for x in PLOT_RMD]
PROCESSING_RMDS = [os.path.join(*x) for x in PROCESSING_RMD]
rule all:
  input:
    os.path.join("_site", "index.html"),
    expand(os.path.join(RESULTS, "{rmd}", "process.html"), rmd = PROCESSING_RMDS),
    expand(os.path.join(RESULTS, "{plot_rmd}.html"), plot_rmd = PLOT_RMDS),

    
rule build_site:
  """ render rmarkdown website
  """
  input:
    rmd = "index.Rmd",
    htmls = expand(os.path.join(RESULTS, "{rmd}.html"), 
      rmd = [PROCESSING_RMDS + PLOT_RMDS])
  output:
    os.path.join("_site", "index.html")
  log:
    "logs/build_site.txt",
  shell:
    """
    R -e "rmarkdown::render_site('{input.rmd}')"
    """
  

rule run_processing_markdown:
  """ 
  render Rmarkdown to produce intermediate data files
  """
  input:
    os.path.join(RESULTS, "{rmd}.Rmd")
  output:
    os.path.join(RESULTS, "{rmd}.html")
  log:
    "logs/build_{rmd}.txt",
  shell:
    """
    R -e "rmarkdown::render('{input}')"
    """

